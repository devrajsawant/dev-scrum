generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id             String   @id @default(cuid())
  clerkUserId    String   @unique
  email          String   @unique
  name           String?
  imageUrl       String?
  createdIssues  Issue[]  @relation("Reporter")
  assignedIssues Issue[]  @relation("Assignee")
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model Project {
  id             String   @id @default(cuid())
  name           String
  key            String
  description    String?
  organizationId String // This will store the Clerk organization ID
  sprints        Sprint[]
  issues         Issue[]
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@unique([organizationId, key]) // unique constraint that 1 organization can have only 1 project with same key to avoid duplicated project keys 
}

model Sprint {
  id        String       @id @default(cuid())
  name      String       @unique
  startDate DateTime
  endDate   DateTime
  status    SprintStatus @default(PLANNED)
  project   Project      @relation(fields: [projectId], references: [id], onDelete: Cascade) // creating a foriegn key relation with collection project and field as project id, and on delete is done as cascade so that deleting project will automatically delete the sprints
  projectId String
  issues    Issue[]
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
}

model Issue {
  id          String        @id @default(cuid())
  title       String
  description String?
  status      IssueStatus
  order       Int // This will store the order within its status column
  priority    IssuePriority
  assignee    User?         @relation("Assignee", fields: [assigneeId], references: [id])
  assigneeId  String?
  reporter    User          @relation("Reporter", fields: [reporterId], references: [id])
  reporterId  String
  project     Project       @relation(fields: [projectId], references: [id], onDelete: Cascade)
  projectId   String
  sprint      Sprint?       @relation(fields: [sprintId], references: [id], onDelete: SetNull)
  sprintId    String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  @@index([status, order])
}

enum SprintStatus {
  PLANNED
  ACTIVE
  COMPLETED
}

enum IssueStatus {
  TODO
  IN_PROGRESS
  IN_REVIEW
  DONE
}

enum IssuePriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}
